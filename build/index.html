<!DOCTYPE html><html><head><title>Colour Hex</title><link rel="shortcut icon" id="favicon"/><style>body {padding: 0px;margin: 0px;background:rgb(128,128,128);}#Hex{background-color:rgb(22,23,27);margin-left:auto;margin-right:auto;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;}</style></head><body><div id="Hex"></div><script>function createCanvas(a,b,c,d){var e=document.createElement("canvas");e.style.position="absolute",e.id=c,e.width=a,e.height=b,e.style.top="0px","undefined"!=typeof d?document.getElementById(d).appendChild(e):document.body.appendChild(e)}function deleteCanvas(a){null!==a&&null!==document.getElementById(a)&&document.getElementById(a).parentNode.removeChild(document.getElementById(a))}function rgbaStringToSet(a){var b=a.substring(a.indexOf("(")+1,a.lastIndexOf(")")),c=b.split(","),d={r:parseInt(c[0]),g:parseInt(c[1]),b:parseInt(c[2]),a:parseFloat(c[3])};return d}function rgbaSetToString(a){return"rgba("+a.r+","+a.g+","+a.b+","+a.a+")"}function keepWithinRange(a,b,c){return b>a?a=b:a>c&&(a=c),a}function GameLoop(){requestAnimation(GameLoop),MainGame.input(),MainGame.update(),MainGame.render()}var requestAnimation=window.requestAnimationFrame||window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame||window.msRequestAnimationFrame||window.oRequestAnimationFrame,Point=function(a,b){"undefined"==typeof a?this.x=null:this.x=a,"undefined"==typeof b?this.y=null:this.y=b};Point.prototype={equals:function(a){this.x=a.x,this.y=a.y},set:function(a,b){this.x=a,this.y=b},distance:function(a){return Math.sqrt(Math.pow(this.x-a.x,2)+Math.pow(this.y-a.y,2))}};var Colours={white:"rgba(206,211,207,1)",lightGrey:"rgba(76,76,79,1)",grey:"rgba(131,131,141,1)",darkGrey:"rgba(43,43,47,1)",black:"rgba(22,23,27,1)",red:"rgba(251,72,102,1)",darkRed:"rgba(176,45,67,1)",green:"rgba(84,254,67,1)",darkGreen:"rgba(52,182,39,1)",blue:"rgba(51,195,251,1)",darkBlue:"rgba(29,125,163,1)",cyan:"rgba(86,248,199,1)",darkCyan:"rgba(30,157,119,1)",purple:"rgba(246,92,246,1)",darkPurple:"rgba(157,33,157,1)",yellow:"rgba(248,211,111,1)",darkYellow:"rgba(130,103,31,1)",burntGreen:"rgba(6,65,44,1)",lightBurntGreen:"rgba(9,103,73,1)",burntRed:"rgba(48,8,17,1)",burntCyan:"rgba(10,112,117,1)",burntBlue:"rgba(25,33,75,1)",none:"rgba(0, 0, 0, 0)",colourPulse:{lightening:!0,pulsing:!1,timer:null,white:"rgba(0,0,0,0)",grey:"rgba(0,0,0,0)",pulse:function(a,b){return a.pulsing&&this.pulsing?this[b]:a.getFill()}},init:function(){this.colourPulse.white=this.white,this.colourPulse.grey=this.grey},darken:function(a){var b=rgbaStringToSet(a),c=b.a;for(var d in b)b[d]>128?b[d]-=80:b[d]-=40;return b.a=c,rgbaSetToString(b)},lighten:function(a){var b=rgbaStringToSet(a),c=b.a;for(var d in b)b[d]>128?b[d]+=25:b[d]+=35;return b.a=c,rgbaSetToString(b)},invertColour:function(a){for(var b in this)if(this[b]===a){var c=null;switch(b){case"red":c="cyan";break;case"cyan":c="red";break;case"green":c="purple";break;case"purple":c="green";break;case"blue":c="yellow";break;case"yellow":c="blue";break;default:c="black"}return this[c]}},setAlpha:function(a,b){var c=rgbaStringToSet(a);return c.a=keepWithinRange(b,0,1),rgbaSetToString(c)},getAlpha:function(a){var b=rgbaStringToSet(a);return b.a},startPulse:function(){this.colourPulse.pulsing||(this.colourPulse.pulsing=!0,this.colourPulse.timer=MainGame.timeNow(),this.colourPulse.lightening=!0)},stopPulse:function(){this.colourPulse.pulsing=!1,this.colourPulse.timer=null},pulse:function(a){MainGame.timeNow()-this.colourPulse.timer>a&&(this.colourPulse.lightening?(this.colourPulse.white=this.lighten(this.white),this.colourPulse.grey=this.lighten(this.grey)):(this.colourPulse.white=this.darken(this.white),this.colourPulse.grey=this.darken(this.grey)),this.colourPulse.lightening=!this.colourPulse.lightening,this.colourPulse.timer=MainGame.timeNow()),this.colourPulse.lightening?(this.colourPulse.white=Motion.adjustColour(this.colourPulse.white,this.darken(this.white),this.lighten(this.white),a),this.colourPulse.grey=Motion.adjustColour(this.colourPulse.grey,this.darken(this.grey),this.lighten(this.grey),a)):(this.colourPulse.white=Motion.adjustColour(this.colourPulse.white,this.lighten(this.white),this.darken(this.white),a),this.colourPulse.grey=Motion.adjustColour(this.colourPulse.grey,this.lighten(this.grey),this.darken(this.grey),a))}},Motion={fillFade:function(a,b,c){function d(){var i;null===e&&(e=MainGame.timeNow()),i=MainGame.timeNow()-e,f.r+=Math.round(Motion.adjustValue(g.r,h.r,c)),f.g+=Math.round(Motion.adjustValue(g.g,h.g,c)),f.b+=Math.round(Motion.adjustValue(g.b,h.b,c)),a.setFill(rgbaSetToString(f)),c>i?a.requestId=requestAnimation(d):(a.animating=!1,a.setFill(b),window.cancelAnimationFrame(a.requestId),a.requestId=void 0)}a.requestId&&(window.cancelAnimationFrame(a.requestId),a.requestId=void 0),"undefined"==typeof c&&(c=400),a.animating=!0;var e=null,f=rgbaStringToSet(a.getFill()),g=rgbaStringToSet(a.getFill()),h=rgbaStringToSet(b);a.requestId=requestAnimation(d)},strokeFade:function(a,b,c){function d(){var i;null===e&&(e=MainGame.timeNow()),i=MainGame.timeNow()-e,f.r+=Math.round(Motion.adjustValue(g.r,h.r,c)),f.g+=Math.round(Motion.adjustValue(g.g,h.g,c)),f.b+=Math.round(Motion.adjustValue(g.b,h.b,c)),a.setStroke(rgbaSetToString(f),a.getStrokeWidth()),c>i?a.requestId=requestAnimation(d):(a.animating=!1,a.setStroke(b,a.getStrokeWidth()),window.cancelAnimationFrame(a.requestId),a.requestId=void 0)}a.requestId&&(window.cancelAnimationFrame(a.requestId),a.requestId=void 0),"undefined"==typeof c&&(c=400),a.animating=!0;var e=null,f=rgbaStringToSet(a.getStrokeColour()),g=rgbaStringToSet(a.getStrokeColour()),h=rgbaStringToSet(b);a.requestId=requestAnimation(d)},tileFade:function(a,b,c,d){function e(){var m;null===f&&(f=MainGame.timeNow()),m=MainGame.timeNow()-f,g.r+=Math.round(Motion.adjustValue(h.r,i.r,d)),g.g+=Math.round(Motion.adjustValue(h.g,i.g,d)),g.b+=Math.round(Motion.adjustValue(h.b,i.b,d)),a.setFill(rgbaSetToString(g)),j.r+=Math.round(Motion.adjustValue(k.r,l.r,d)),j.g+=Math.round(Motion.adjustValue(k.g,l.g,d)),j.b+=Math.round(Motion.adjustValue(k.b,l.b,d)),a.setStroke(rgbaSetToString(j),a.getStrokeWidth()),d>m?a.requestId=requestAnimation(e):(a.animating=!1,a.setFill(b),a.setStroke(c,a.getStrokeWidth()),window.cancelAnimationFrame(a.requestId),a.requestId=void 0)}a.requestId&&(window.cancelAnimationFrame(a.requestId),a.requestId=void 0),"undefined"==typeof d&&(d=400),a.animating=!0;var f=null,g=rgbaStringToSet(a.getFill()),h=rgbaStringToSet(a.getFill()),i=rgbaStringToSet(b),j=rgbaStringToSet(a.getStrokeColour()),k=rgbaStringToSet(a.getStrokeColour()),l=rgbaStringToSet(c);a.requestId=requestAnimation(e)},adjustValue:function(a,b,c){return(b-a)*(MainGame.lastFrameTime/c)},adjustColour:function(a,b,c,d){var e=rgbaStringToSet(a),f=rgbaStringToSet(b),g=rgbaStringToSet(c);return e.r+=Math.round(Motion.adjustValue(f.r,g.r,d)),e.g+=Math.round(Motion.adjustValue(f.g,g.g,d)),e.b+=Math.round(Motion.adjustValue(f.b,g.b,d)),rgbaSetToString(e)}},Hexagon=function(a,b,c){this.SIDES=6,this.radius=a,this.center=new Point(b,c),this.mouseOver=!1,this.selected=!1,this.pulsing=!1,this.visible=!0,this.width=2*this.radius,this.height=Math.sqrt(3)/2*this.width,this.strokeColour="rgba(0,0,0,1)",this.fillColour="rgba(128,128,128,1)",this.strokeWidth=.5,this.invertAnimTime=150,this.tileData={primaryColour:Colours.white,pulseType:"grey",inverted:!1,changerType:-1,changerPoint:new Point(999,999),changerActive:!1},this.animationTime=150};Hexagon.prototype={draw:function(a){if(this.visible){var b=document.getElementById(a).getContext("2d");b.beginPath();var c=2*Math.PI/this.SIDES*0;b.moveTo(this.center.x+this.radius*Math.cos(c),this.center.y+this.radius*Math.sin(c));for(var d=1;d<=this.SIDES;d++)c=2*Math.PI/this.SIDES*d,b.lineTo(this.center.x+this.radius*Math.cos(c),this.center.y+this.radius*Math.sin(c));b.strokeStyle=this.strokeColour,b.fillStyle=Colours.colourPulse.pulse(this,this.tileData.pulseType),b.lineWidth=this.strokeWidth,b.closePath(),b.fill(),b.stroke()}},setStroke:function(a,b){this.strokeColour=a,this.strokeWidth=b},setFill:function(a){this.fillColour=a},setColour:function(a){this.setFill(a),this.setStroke(Colours.darken(a),this.strokeWidth)},setRadius:function(a){this.radius=a},setCenter:function(a,b){this.center.x=a,this.center.y=b},setCenterFromPoint:function(a){this.setCenter(a.x,a.y)},setTileData:function(a,b){this.tileData.primaryColour=a,this.tileData.inverted=b},invertColour:function(){if(this.visible){this.tileData.inverted=!this.tileData.inverted;var a=this.tileData.primaryColour;this.tileData.inverted&&(a=Colours.invertColour(this.tileData.primaryColour)),Motion.tileFade(this,a,Colours.darken(a),this.invertAnimTime)}},getFill:function(){return this.fillColour},getStrokeColour:function(){return this.strokeColour},getStrokeWidth:function(){return this.strokeWidth},calculateDimentions:function(){this.width=2*this.radius,this.height=Math.sqrt(3)/2*this.width},getHeight:function(){return this.height},getWidth:function(){return this.width}};var HexagonalGridSystem={calculateHexagonWidth:function(a){return 2*a},calculateHexagonHeight:function(a){return Math.sqrt(3)/2*this.calculateHexagonWidth(a)},gridCoordToPixelCoord:function(a,b,c){return this.externalGridCoordToPixelCoord(a,b,c)},pixelCoordToGridCoord:function(a,b,c){return this.externalPixelCoordToGridCoord(a,b,c)},externalGridCoordToPixelCoord:function(a,b,c){"undefined"==typeof b&&(b=new Point(0,0));var d=0,e=0;return d=3*c/2*a.x,e=c*Math.sqrt(3)*(a.y+a.x/2),new Point(d+b.x,e+b.y)},externalPixelCoordToGridCoord:function(a,b,c){"undefined"==typeof b&&(b=new Point(0,0)),pPoint=new Point(a.x,a.y),pPoint.x-=b.x,pPoint.y-=b.y;var d=new Point(0,0);d.x=2/3*pPoint.x/c,d.y=(1/3*Math.sqrt(3)*pPoint.y-1/3*pPoint.x)/c;var e=this.hexRound(this.convertAxialToCube(d));return this.convertCubeToAxial(e)},distance:function(a,b){var c=this.convertAxialToCube(a),d=this.convertAxialToCube(b);return this.cubeDistance(c,d)},cubeDistance:function(a,b){return(Math.abs(a.x-b.x)+Math.abs(a.y-b.y)+Math.abs(a.z-b.z))/2},hexRound:function(a){var b={x:Math.round(a.x),y:Math.round(a.y),z:Math.round(a.z)},c={x:Math.abs(b.x-a.x),y:Math.abs(b.y-a.y),z:Math.abs(b.z-a.z)};return c.x>c.y&&c.x>c.z?b.x=-b.y-b.z:c.y>c.z?b.y=-b.x-b.z:b.z=-b.x-b.y,b},convertAxialToCube:function(a){return{x:a.x,y:a.y,z:-a.x-a.y}},convertCubeToAxial:function(a){return new Point(a.x,a.y)}},Input={mouseEnabled:!0,mouseOffset:new Point(0,0),mousePosition:new Point(0,0),mouseHexaGridPos:new Point(999,999),startDragPosition:new Point(0,0),mouseOver:!1,mouseDown:!1,dragStartTime:0,dragStartTimer:1e3,dragStartMouseMoveDistance:12,dragging:!1,createInput:function(){this.addMouseListeners(MainGame.currentState)},addMouseListeners:function(a){null!==a&&null!==document.getElementById(a)&&(document.getElementById(a).addEventListener("mousedown",this.onMouseDown,!1),document.getElementById(a).addEventListener("mouseup",this.onMouseUp,!1),document.getElementById(a).addEventListener("mouseover",this.onMouseOver,!1),document.getElementById(a).addEventListener("mouseout",this.onMouseOut,!1),document.getElementById(a).addEventListener("mousemove",this.updateMousePosition,!1))},removeMouseListeners:function(a){null!==a&&null!==document.getElementById(a)&&(document.getElementById(a).removeEventListener("mousedown",this.onMouseDown,!1),document.getElementById(a).removeEventListener("mouseup",this.onMouseUp,!1),document.getElementById(a).removeEventListener("mouseover",this.onMouseOver,!1),document.getElementById(a).removeEventListener("mouseout",this.onMouseOut,!1),document.getElementById(a).removeEventListener("mousemove",this.updateMousePosition,!1))},onClick:function(a){Input.dragging?Input.onMouseDragStop(a):"undefined"!=typeof MainGame.states[MainGame.currentState].onClick&&MainGame.states[MainGame.currentState].onClick()},onMouseDragStart:function(a){Input.dragging=!0,"undefined"!=typeof MainGame.states[MainGame.currentState].onMouseDragStart&&MainGame.states[MainGame.currentState].onMouseDragStart()},onMouseDragStop:function(a){"undefined"!=typeof MainGame.states[MainGame.currentState].onMouseDragStop&&MainGame.states[MainGame.currentState].onMouseDragStop()},onMouseDown:function(a){Input.dragStartTime=MainGame.timeNow(),Input.mouseDown=!0,Input.startDragPosition.equals(Input.mousePosition)},onMouseUp:function(a){MainGame.timeNow()-Input.dragStartTime<=Input.dragStartTimer?Input.onClick(a):Input.onMouseDragStop(a),Input.mouseDown=!1,Input.dragging=!1},updateMousePosition:function(a){Input.mouseEnabled&&(Input.mouseOver&&(Input.mousePosition.x=a.clientX-Input.mouseOffset.x,Input.mousePosition.y=a.clientY-Input.mouseOffset.y,Input.mouseHexaGridPos=HexagonalGridSystem.pixelCoordToGridCoord(Input.mousePosition,GameMap.gridCenter,GameMap.hexRadius)),Input.mouseDown&&!Input.dragging&&(MainGame.timeNow()-Input.dragStartTime>Input.dragStartTimer||Input.startDragPosition.distance(Input.mousePosition)>Input.dragStartMouseMoveDistance)&&Input.onMouseDragStart(),Input.dragging&&"undefined"!=typeof MainGame.states[MainGame.currentState].onMouseDrag&&MainGame.states[MainGame.currentState].onMouseDrag())},disableMouse:function(){Input.mouseEnabled&&(Input.mouseEnabled=!1,Input.mousePosition.x=-999,Input.mousePosition.y=-999,Input.mouseHexaGridPos.x=-999,Input.mouseHexaGridPos.y=-999)},enableMouse:function(){Input.mouseEnabled||(Input.mouseEnabled=!0)},onMouseOver:function(){Input.mouseOver=!0,Input.calculateOffset()},onMouseOut:function(){Input.mouseOver=!1},calculateOffset:function(){this.mouseOffset.x=document.getElementById(MainGame.currentState).offsetLeft,this.mouseOffset.y=document.getElementById(MainGame.currentState).offsetTop}},Tutorial={boxTopLeft:new Point(25,501),boxWidth:974,boxHeight:50,completed:!1,currentMessage:1,messages:["Click on the tile in the middle to place an inverter there","Click on the left button in the menu to select a line inverter","Click on the middle button in the menu to select a circle inverter","Click on the right button in the menu to select a ring inverter","Click and drag on the inverter to change the tile colours","Try to change tile colours to match the hint button colour"],draw:function(){this.completed||(this.drawBlock(MainGame.currentState),this.drawText(MainGame.currentState))},drawBlock:function(a){var b=document.getElementById(a).getContext("2d");b.strokeStyle=Colours.setAlpha(Colours.grey,.3),b.fillStyle=Colours.setAlpha(Colours.darkGrey,.5),b.lineWidth=2,b.fillRect(this.boxTopLeft.x,this.boxTopLeft.y,this.boxWidth,this.boxHeight),b.strokeRect(this.boxTopLeft.x,this.boxTopLeft.y,this.boxWidth,this.boxHeight)},drawText:function(a){var b=document.getElementById(a).getContext("2d");b.font="25px Arial",b.fillStyle=Colours.white,b.textAlign="center",b.textBaseline="middle",b.fillText(this.messages[this.currentMessage-1],MainGame.stageWidth/2,this.boxTopLeft.y+this.boxHeight/2)},nextMessage:function(){this.completed||(1===this.currentMessage&&Changers.active&&(1===LevelBuilder.currentLevel?this.currentMessage=2:2===LevelBuilder.currentLevel?this.currentMessage=3:3===LevelBuilder.currentLevel&&(this.currentMessage=4)),(2===this.currentMessage||3===this.currentMessage||4===this.currentMessage)&&Changers.placedChangers.length>0?this.currentMessage=5:5===this.currentMessage&&Changers.placedChangers.length>0&&(this.currentMessage=6))},resetMessage:function(){LevelBuilder.currentLevel<=3?this.currentMessage=1:this.completed=!0}},Message={active:!1,boxTopLeft:new Point(162,170),boxWidth:700,boxHeight:200,nextLevel:!1,partTwo:!1,displayMessage:function(a){this.active||(this.active=!0)},destroyMessage:function(){return this.partTwo?void(this.active&&(this.active=!1,this.nextLevel&&(GameMap.loadNextLevel(),this.nextLevel=!1))):void(this.partTwo=!0)},completeMessage:function(){this.displayMessage(),this.nextLevel=!0},startMessage:function(){LevelBuilder.currentLevel<=4&&this.displayMessage()},draw:function(){this.active&&(this.drawBlock(MainGame.currentState),this.nextLevel?LevelData.validLevel(LevelBuilder.currentLevel+1)?this.drawLevelCompleteText(MainGame.currentState):this.drawGameCompleteText(MainGame.currentState):this.drawStartMessage(MainGame.currentState),this.drawClickNextText(MainGame.currentState))},drawBlock:function(a){var b=document.getElementById(a).getContext("2d");b.fillStyle=Colours.setAlpha(Colours.black,.7),b.fillRect(0,0,MainGame.stageWidth,MainGame.stageWidth),b.strokeStyle=Colours.setAlpha(Colours.grey,.5),b.fillStyle=Colours.setAlpha(Colours.darkGrey,.8),b.lineWidth=3,b.fillRect(this.boxTopLeft.x,this.boxTopLeft.y,this.boxWidth,this.boxHeight),b.strokeRect(this.boxTopLeft.x,this.boxTopLeft.y,this.boxWidth,this.boxHeight)},drawLevelCompleteText:function(a){var b=document.getElementById(a).getContext("2d");b.font="60px Arial",b.fillStyle=Colours.white,b.textAlign="center",b.textBaseline="bottom",b.fillText("Well done!",MainGame.stageWidth/2,this.boxTopLeft.y+this.boxHeight/2.5),b.font="40px Arial",b.fillText("You have completed the level",MainGame.stageWidth/2,this.boxTopLeft.y+this.boxHeight/4*3)},drawGameCompleteText:function(a){var b=document.getElementById(a).getContext("2d");b.font="60px Arial",b.fillStyle=Colours.white,b.textAlign="center",b.textBaseline="bottom",b.fillText("Congratulations!",MainGame.stageWidth/2,this.boxTopLeft.y+this.boxHeight/2.5),b.font="40px Arial",b.fillText("You have completed invertagon",MainGame.stageWidth/2,this.boxTopLeft.y+this.boxHeight/4*3)},drawStartMessage:function(a){var b=document.getElementById(a).getContext("2d");b.font="30px Arial",b.fillStyle=Colours.white,b.textAlign="center",b.textBaseline="bottom",1!==LevelBuilder.currentLevel||this.partTwo?1===LevelBuilder.currentLevel&&this.partTwo?(b.fillText("The line inverter",MainGame.stageWidth/2,this.boxTopLeft.y+this.boxHeight/4),b.font="20px Arial",b.fillText("The line inverter inverts all tiles in a straight line",MainGame.stageWidth/2,this.boxTopLeft.y+this.boxHeight/4*2),b.fillText("It can be pointed in any direction perpendicular to the hexagon's sides",MainGame.stageWidth/2,this.boxTopLeft.y+this.boxHeight/4*2.75)):2===LevelBuilder.currentLevel?(b.fillText("The circle inverter",MainGame.stageWidth/2,this.boxTopLeft.y+this.boxHeight/4),b.font="20px Arial",b.fillText("The circle inverter inverts all the tiles around it",MainGame.stageWidth/2,this.boxTopLeft.y+this.boxHeight/4*2),b.fillText("It can affect tiles around it up to two tiles away",MainGame.stageWidth/2,this.boxTopLeft.y+this.boxHeight/4*2.75)):3===LevelBuilder.currentLevel?(b.fillText("The ring inverter",MainGame.stageWidth/2,this.boxTopLeft.y+this.boxHeight/4),b.font="20px Arial",b.fillText("The ring inverter inverts tiles in a ring around it",MainGame.stageWidth/2,this.boxTopLeft.y+this.boxHeight/4*2),b.fillText("It can not affect the tiles directly next to it, but it has unlimited range",MainGame.stageWidth/2,this.boxTopLeft.y+this.boxHeight/4*2.75)):4===LevelBuilder.currentLevel&&(b.fillText("Interacting with inverters",MainGame.stageWidth/2,this.boxTopLeft.y+this.boxHeight/4),b.font="20px Arial",b.fillText("Click on a placed inverter to remove or replace it",MainGame.stageWidth/2,this.boxTopLeft.y+this.boxHeight/4*2),b.fillText("For help, click on the hint button to show where an inverter should be placed",MainGame.stageWidth/2,this.boxTopLeft.y+this.boxHeight/4*2.75),b.fillText("Good luck and have fun",MainGame.stageWidth/2,this.boxTopLeft.y+this.boxHeight/4*3.5)):(b.fillText("Welcome to invertagon",MainGame.stageWidth/2,this.boxTopLeft.y+this.boxHeight/4),b.font="20px Arial",b.fillText("Note the colour of the hint button in the top right corner",MainGame.stageWidth/2,this.boxTopLeft.y+this.boxHeight/4*2),b.fillText("Match all tiles to the hint button colour to complete the level",MainGame.stageWidth/2,this.boxTopLeft.y+this.boxHeight/4*2.75))},drawClickNextText:function(a){var b=document.getElementById(a).getContext("2d");b.font="20px Arial",b.fillStyle=Colours.grey,b.textAlign="right",b.textBaseline="bottom",b.fillText("Click to continue",this.boxTopLeft.x+this.boxWidth-10,this.boxTopLeft.y+this.boxHeight-10)}},MainMenu={canvasElement:null,boardSize:3,gridCenter:new Point(0,0),howToPlayCenterPoint:new Point(0,0),hexRadius:130,tiles:[],buttonHexagons:[],moving:!1,atMenu:!0,moveSpeed:75,maxSpeedX:0,create:function(){this.canvasElement=document.getElementById(MainGame.currentState),this.gridCenter.x=MainGame.stageWidth/2,this.gridCenter.y=.75*MainGame.stageHeight,GameMap.gridCenter=new Point(this.gridCenter.x,this.gridCenter.y),GameMap.hexRadius=this.hexRadius,this.howToPlayCenterPoint.x=this.gridCenter.x-1.1*MainGame.stageWidth,this.howToPlayCenterPoint.y=MainGame.stageHeight/2,this.maxSpeedX=(this.howToPlayCenterPoint.x-this.gridCenter.x)/2+this.gridCenter.x;for(var a=Colours.none,b=Colours.setAlpha(Colours.darkGrey,.6),c=0,d=-this.boardSize;d<=this.boardSize;d++)for(var e=-this.boardSize;e<=this.boardSize;e++){var f=HexagonalGridSystem.gridCoordToPixelCoord(new Point(d,e),this.gridCenter,this.hexRadius);"undefined"==typeof this.tiles[d]&&(this.tiles[d]=[]),f.y>-this.hexRadius&&f.y<MainGame.stageHeight+this.hexRadius&&f.x>-this.hexRadius&&f.x<MainGame.stageWidth+this.hexRadius&&(this.tiles[d][e]=new Hexagon(this.hexRadius-5,f.x,f.y),this.tiles[d][e].setFill(a),this.tiles[d][e].setStroke(b,2),c++)}this.tiles[0][0].setStroke(Colours.white,this.tiles[0][0].getStrokeWidth()),this.tiles[-1][0].setStroke(Colours.white,this.tiles[-1][0].getStrokeWidth()),this.tiles[1][-1].setStroke(Colours.white,this.tiles[1][-1].getStrokeWidth()),this.buttonHexagons[0]=new Hexagon(this.hexRadius-15,this.tiles[0][0].center.x,this.tiles[0][0].center.y),this.buttonHexagons[1]=new Hexagon(this.hexRadius-15,this.tiles[-1][0].center.x,this.tiles[-1][0].center.y),this.buttonHexagons[2]=new Hexagon(this.hexRadius-15,this.tiles[1][-1].center.x,this.tiles[1][-1].center.y)},onClick:function(){this.moving||(1===Input.mouseHexaGridPos.x&&-1===Input.mouseHexaGridPos.y?this.move():-1===Input.mouseHexaGridPos.x&&0===Input.mouseHexaGridPos.y&&MainGame.startState("gameBoard"),this.atMenu||Input.mousePosition.x>=0&&Input.mousePosition.x<=.1*MainGame.stageWidth&&Input.mousePosition.y>=.1*MainGame.stageHeight&&Input.mousePosition.y<=.9*MainGame.stageHeight&&this.move())},update:function(){this.moveBoard()},render:function(){var a=this.canvasElement.getContext("2d");for(var b in this.tiles)for(var c in this.tiles[b])this.tiles[b][c].draw(MainGame.currentState);a.font="normal 95px Arial",a.textAlign="center",a.textBaseline="top",a.fillStyle=Colours.white,a.fillText("invertagon",this.gridCenter.x,30),this.drawButtons(a),this.drawHowToPlay(a)},drawButtons:function(a){this.buttonHexagons[0].setFill(Colours.blue),this.buttonHexagons[1].setFill(Colours.green),this.buttonHexagons[2].setFill(Colours.red),1===Input.mouseHexaGridPos.x&&-1===Input.mouseHexaGridPos.y?this.buttonHexagons[2].setFill(Colours.white):-1===Input.mouseHexaGridPos.x&&0===Input.mouseHexaGridPos.y&&this.buttonHexagons[1].setFill(Colours.white);for(var b in this.buttonHexagons)this.buttonHexagons[b].draw(MainGame.currentState);a.font="normal 55px Arial",a.textAlign="center",a.textBaseline="middle",a.fillStyle=Colours.black,a.fillText("start",this.buttonHexagons[1].center.x,this.buttonHexagons[1].center.y-35),a.fillText("game",this.buttonHexagons[1].center.x,this.buttonHexagons[1].center.y+20),a.fillText("how",this.buttonHexagons[2].center.x,this.buttonHexagons[2].center.y-35),a.fillText("to play",this.buttonHexagons[2].center.x,this.buttonHexagons[2].center.y+20),a.font="25px Arial",a.fillStyle=Colours.burntBlue,a.fillText("game by",this.buttonHexagons[0].center.x,this.buttonHexagons[0].center.y-60),a.font="bold 27px Arial",a.fillText("Jeremy",this.buttonHexagons[0].center.x,this.buttonHexagons[0].center.y+-10),a.fillText("de Reuck",this.buttonHexagons[0].center.x,this.buttonHexagons[0].center.y+25)},drawHowToPlay:function(a){var b=this.gridCenter.x-this.howToPlayCenterPoint.x+MainGame.stageWidth/2;a.font="normal 75px Arial",a.textAlign="center",a.textBaseline="top",a.fillStyle=Colours.white,a.fillText("how to play",b,.05*MainGame.stageHeight),a.font="normal 25px Arial",a.textAlign="center",a.textBaseline="top",a.fillText("The objective is to invert all secondary colours to primary colours",b,.25*MainGame.stageHeight),a.fillText("This is done by placing and activating inverters on the board",b,.5*MainGame.stageHeight),a.fillText("Click on a tile to open the quick-select menu",b,.75*MainGame.stageHeight),a.fillText("From here you will be able to place or remove inverters",b,.8*MainGame.stageHeight),a.fillText("Click and drag on a placed inverter to change its influence area",b,.85*MainGame.stageHeight);var c=new Hexagon(30,0,.4*MainGame.stageHeight);c.setStroke(Colours.none,0),this.drawHex(c,b-.16*MainGame.stageWidth,"red"),this.drawHex(c,b-.2*MainGame.stageWidth,"cyan"),this.drawHex(c,b+.02*MainGame.stageWidth,"green"),this.drawHex(c,b-.02*MainGame.stageWidth,"purple"),this.drawHex(c,b+.2*MainGame.stageWidth,"blue"),this.drawHex(c,b+.16*MainGame.stageWidth,"yellow"),Changers.drawLineIcon({x:b-.18*MainGame.stageWidth,y:.65*MainGame.stageHeight},MainGame.currentState,Colours.white,Colours.grey),Changers.drawCircleIcon({x:b,y:.65*MainGame.stageHeight},MainGame.currentState,Colours.white,Colours.grey),Changers.drawRingIcon({x:b+.18*MainGame.stageWidth,y:.65*MainGame.stageHeight},MainGame.currentState,Colours.white,Colours.grey),a.fillStyle=Colours.red,this.atMenu||this.moving||Input.mousePosition.x>=0&&Input.mousePosition.x<=.1*MainGame.stageWidth&&Input.mousePosition.y>=.1*MainGame.stageHeight&&Input.mousePosition.y<=.9*MainGame.stageHeight&&(a.fillStyle=Colours.white),a.fillRect(b-.5*MainGame.stageWidth,.1*MainGame.stageHeight,.1*MainGame.stageWidth,.8*MainGame.stageHeight),a.fillStyle=Colours.black,a.font="bold 50px Arial",a.textAlign="center",a.textBaseline="middle",a.save(),a.rotate(-Math.PI/2),a.fillText("back to menu",-(.275*MainGame.stageWidth),b-.8*MainGame.stageHeight),a.restore()},drawHex:function(a,b,c){a.setFill(Colours[c]),a.center.x=b,a.draw(MainGame.currentState)},move:function(){this.moving=!0},moveBoard:function(){if(this.moving){var a=1-Math.abs(this.gridCenter.x-this.maxSpeedX)/(.57*MainGame.stageWidth);this.atMenu?(this.gridCenter.x-=this.moveSpeed*a,GameMap.gridCenter.x=this.gridCenter.x):(this.gridCenter.x+=this.moveSpeed*a,GameMap.gridCenter.x=this.gridCenter.x),this.atMenu?this.gridCenter.x<=this.howToPlayCenterPoint.x&&(this.gridCenter.x=this.howToPlayCenterPoint.x,GameMap.gridCenter.x=this.gridCenter.x,this.moving=!1,this.atMenu=!1):this.gridCenter.x>=MainGame.stageWidth/2&&(this.gridCenter.x=MainGame.stageWidth/2,GameMap.gridCenter.x=this.gridCenter.x,this.moving=!1,this.atMenu=!0),this.updateTilePositions()}},updateTilePositions:function(){for(var a in this.tiles)for(var b in this.tiles[a]){var c=HexagonalGridSystem.gridCoordToPixelCoord(new Point(parseInt(a),parseInt(b)),this.gridCenter,this.hexRadius);this.tiles[a][b].center.x=c.x,this.tiles[a][b].center.y=c.y,0===parseInt(a)&&0===parseInt(b)?(this.buttonHexagons[0].center.x=c.x,this.buttonHexagons[0].center.y=c.y):-1===parseInt(a)&&0===parseInt(b)?(this.buttonHexagons[1].center.x=c.x,this.buttonHexagons[1].center.y=c.y):1===parseInt(a)&&-1===parseInt(b)&&(this.buttonHexagons[2].center.x=c.x,this.buttonHexagons[2].center.y=c.y)}},deleteState:function(){this.canvasElement=null,this.boardSize=3,this.gridCenter=new Point(0,0),this.hexRadius=130,this.tiles=[],this.buttonHexagons=[],this.moving=!1,this.atMenu=!0,this.moveSpeed=75,this.maxSpeedX=0}},LevelData={_1:{changers:[1,0,0],tiles:[0,0,0,1,0,-3,0,-2,0,-1,1,0,1,-3,1,-2,1,-1,2,-3,2,-2,2,-1,-2,0,-2,1,-2,-1,-1,0,-1,1,-1,-2,-1,-1],colours:[1,0,1,0,1,0,1,0,1,1,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,1,1,0,1,1,1,0,1,0,1,0],hints:[0,-1]},_2:{changers:[0,1,0],tiles:[0,0,0,1,0,2,0,3,0,-3,0,-2,0,-1,1,0,1,1,1,2,1,-3,1,-2,1,-1,2,0,2,1,2,-3,2,-2,2,-1,3,0,3,-3,3,-2,3,-1,-3,0,-3,1,-3,2,-3,3,-2,0,-2,1,-2,2,-2,3,-2,-1,-1,0,-1,1,-1,2,-1,3,-1,-2,-1,-1],colours:[2,1,2,1,2,1,2,0,2,0,2,1,2,1,2,1,2,1,2,0,2,0,2,1,2,1,2,1,2,0,2,0,2,1,2,1,2,0,2,0,2,0,2,0,2,0,2,0,2,0,2,0,2,1,2,1,2,1,2,0,2,0,2,1,2,1,2,1,2,0,2,0,2,1],hints:[0,0]},_3:{changers:[0,0,1],tiles:[0,0,0,1,0,2,0,3,0,-3,0,-2,0,-1,1,0,1,1,1,2,1,-3,1,-2,1,-1,2,0,2,1,2,-3,2,-2,2,-1,3,0,3,-3,3,-2,3,-1,-3,0,-3,1,-3,2,-3,3,-2,0,-2,1,-2,2,-2,3,-2,-1,-1,0,-1,1,-1,2,-1,3,-1,-2,-1,-1],colours:[3,1,3,0,3,0,3,1,3,1,3,0,3,0,3,0,3,0,3,1,3,1,3,0,3,0,3,0,3,1,3,1,3,0,3,0,3,1,3,1,3,1,3,1,3,1,3,1,3,1,3,1,3,0,3,0,3,0,3,1,3,1,3,0,3,0,3,0,3,1,3,1,3,0],hints:[0,0]},_4:{changers:[3,0,0],tiles:[0,0,0,1,0,2,0,-2,0,-1,1,0,1,1,1,2,1,-2,1,-1,2,0,2,1,2,-1,3,0,3,-2,3,-1,4,-2,4,-1,-4,2,-4,3,-3,1,-3,2,-3,3,-2,1,-2,2,-2,3,-1,0,-1,1,-1,2,-1,3,-1,-1],colours:[1,1,1,1,1,0,1,1,1,1,1,0,1,1,1,0,1,0,1,0,1,1,1,0,1,0,1,0,1,0,1,1,1,1,1,0,1,1,1,0,1,0,1,1,1,0,1,0,1,1,1,0,1,0,1,0,1,1,1,0,1,0],hints:[0,1,-1,2,1,1]},_5:{changers:[0,2,0],tiles:[0,0,0,1,0,2,0,3,0,-3,0,-2,0,-1,1,0,1,1,1,2,1,-3,1,-2,1,-1,2,0,2,1,2,-3,2,-2,2,-1,3,0,3,-3,3,-2,3,-1,4,-3,4,-2,4,-1,-3,0,-3,1,-3,2,-3,3,-2,0,-2,1,-2,2,-2,3,-2,-1,-1,0,-1,1,-1,2,-1,3,-1,-2,-1,-1],colours:[2,1,2,1,2,1,2,0,2,0,2,1,2,1,2,0,2,1,2,0,2,0,2,1,2,0,2,0,2,0,2,0,2,0,2,0,2,0,2,0,2,1,2,1,2,0,2,0,2,0,2,0,2,0,2,0,2,0,2,1,2,1,2,1,2,0,2,0,2,1,2,1,2,1,2,0,2,0,2,1],hints:[0,0,2,-1]},_6:{changers:[0,0,2],tiles:[0,0,0,1,0,2,0,-2,0,-1,1,0,1,1,1,2,1,-3,1,-2,1,-1,2,0,2,1,2,2,2,-4,2,-3,2,-2,2,-1,3,0,3,1,3,-4,3,-3,3,-2,3,-1,4,0,4,-4,4,-3,4,-2,4,-1,5,-4,5,-3,5,-2,5,-1,-5,2,-5,3,-4,1,-4,2,-4,3,-3,0,-3,1,-3,2,-3,3,-2,0,-2,1,-2,2,-2,3,-2,-1,-1,0,-1,1,-1,2,-1,-1],colours:[3,1,3,1,3,1,3,1,3,1,3,0,3,0,3,1,3,1,3,0,3,0,3,0,3,0,3,1,3,1,3,0,3,0,3,1,3,0,3,1,3,1,3,0,3,0,3,0,3,1,3,1,3,0,3,0,3,0,3,1,3,1,3,1,3,1,3,0,3,0,3,1,3,1,3,1,3,1,3,0,3,0,3,1,3,0,3,1,3,0,3,1,3,1,3,1,3,1,3,0,3,0],hints:[2,-1,-2,1]},_7:{changers:[1,0,1],tiles:[0,0,0,1,0,2,0,3,0,-3,0,-1,1,0,1,2,1,-3,1,-1,2,1,2,-3,2,-2,3,0,3,-3,3,-2,3,-1,4,-4,5,-5,-5,5,-4,4,-3,0,-3,1,-3,2,-3,3,-2,0,-2,3,-2,-1,-1,0,-1,1,-1,3,-1,-2],colours:[1,0,1,0,1,0,1,1,1,1,1,0,1,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,1,1,1,1,1,1,1,1,1,0,1,1,1,1,1,1,1,1,1,0,1,0,1,1,1,1,1,0,1,1,1,1,1,1],hints:[0,0,-4,4]},_8:{changers:[2,0,2],tiles:[0,0,0,2,0,-2,1,0,1,1,1,-2,1,-1,2,0,2,1,2,-3,2,-2,3,0,3,1,3,-4,3,-3,4,0,4,-4,4,-2,-4,0,-4,2,-4,4,-3,0,-3,3,-3,4,-3,-1,-2,0,-2,2,-2,3,-2,-1,-1,0,-1,1,-1,2,-1,-1],colours:[2,0,2,0,2,0,2,0,2,1,2,1,2,0,2,1,2,1,2,1,2,1,2,1,2,1,2,1,2,1,2,0,2,1,2,1,2,1,2,1,2,0,2,1,2,1,2,1,2,1,2,1,2,1,2,1,2,1,2,0,2,0,2,1,2,1],hints:[-4,2,4,-2,-3,3,3,0]},_9:{changers:[2,2,1],tiles:[0,0,0,1,0,2,0,-2,0,-1,1,0,1,1,1,-2,1,-1,4,0,4,-4,5,0,5,-5,-5,0,-5,5,-4,0,-4,4,-1,0,-1,1,-1,2,-1,-1],colours:[3,1,3,1,3,1,3,1,3,1,3,1,3,1,3,1,3,1,3,0,3,0,3,1,3,1,3,1,3,1,3,0,3,0,3,1,3,1,3,1,3,1],hints:[0,0,0,-2,0,2,-5,5,5,0]},_10:{changers:[1,1,1],tiles:[0,0,0,1,0,2,0,-2,0,-1,1,-2,2,-4,2,-2,2,-1,3,-4,4,-4,4,-3,4,-2,-4,2,-4,3,-4,4,-3,4,-2,1,-2,2,-2,4,-1,2],colours:[1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,1,1,0,1,0,1,1,1,1,1,0,1,1,1,0,1,1,1,1,1,0],hints:[0,0,-4,4,4,-4]},_11:{changers:[2,1,1],tiles:[0,1,0,-1,1,-2,2,-3,3,0,3,-4,3,-1,4,-3,4,-2,4,-1,5,-4,5,-3,-4,1,-4,3,-3,0,-3,2,-2,0,-2,1,-2,2,-2,3,-2,-1,-1,0,-1,2],colours:[2,1,2,0,2,1,2,1,2,0,2,0,2,1,2,1,2,1,2,1,2,0,2,1,2,1,2,0,2,1,2,1,2,1,2,1,2,1,2,0,2,0,2,1,2,1],hints:[-2,1,4,-2,-2,3,2,-3]},_12:{changers:[2,1,1],tiles:[0,1,0,-1,1,0,1,1,1,-2,1,-1,2,-3,2,-1,3,-2,3,-1,4,-1,-5,1,-5,2,-5,3,-5,4,-4,0,-4,1,-4,3,-4,4,-3,0,-3,3,-3,4,-3,-1,-2,1,-1,0,-1,1],colours:[3,0,3,0,3,0,3,1,3,1,3,0,3,0,3,1,3,1,3,1,3,1,3,1,3,1,3,1,3,1,3,1,3,1,3,1,3,1,3,0,3,0,3,1,3,1,3,1,3,1,3,1],hints:[-2,1,-4,1,-4,3,2,-1]},_13:{changers:[2,2,1],tiles:[0,0,0,1,0,-1,1,0,1,1,1,-2,1,-1,2,0,2,-2,2,-1,3,1,3,-4,4,0,4,-4,4,-3,4,-1,-4,0,-4,1,-4,3,-4,4,-3,4,-3,-1,-2,0,-2,1,-2,2,-1,0,-1,1,-1,2,-1,-1],colours:[1,1,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,1,1,1,1,1,1,0,1,0,1,1,1,1,1,0,1,1,1,1,1,0,1,1,1,1,1,0,1,1,1,0,1,0,1,0,1,0,1,0],hints:[0,0,-2,1,2,-1,-4,0,4,-4]},_14:{changers:[0,1,3],tiles:[0,0,0,1,0,2,0,3,0,-3,1,1,1,2,1,-3,1,-2,1,-1,2,1,2,-3,2,-2,2,-1,3,0,3,-3,3,-2,3,-1,-3,0,-3,1,-3,2,-3,3,-2,0,-2,1,-2,3,-2,-1,-1,0,-1,2,-1,3,-1,-2,-1,-1],colours:[2,1,2,1,2,1,2,1,2,1,2,1,2,1,2,1,2,1,2,1,2,1,2,1,2,1,2,1,2,1,2,1,2,1,2,1,2,1,2,1,2,1,2,1,2,1,2,1,2,1,2,1,2,1,2,1,2,1,2,1,2,1],hints:[0,0,-3,0,3,-3,0,3]},_15:{changers:[2,2,1],tiles:[0,0,0,2,0,3,0,-3,0,-2,1,1,1,-2,2,0,2,1,2,-3,2,-2,2,-1,3,0,3,-3,4,1,4,-5,5,0,5,-5,5,-4,5,-1,-5,0,-5,1,-5,4,-5,5,-4,5,-4,-1,-3,0,-3,3,-2,0,-2,1,-2,2,-2,3,-2,-1,-1,2,-1,-1],
colours:[3,1,3,1,3,1,3,1,3,1,3,1,3,1,3,0,3,1,3,1,3,0,3,0,3,1,3,1,3,1,3,1,3,0,3,0,3,1,3,1,3,0,3,1,3,1,3,0,3,1,3,1,3,1,3,1,3,0,3,0,3,0,3,1,3,1,3,1,3,1],hints:[0,0,0,-2,0,2,-5,5,5,0]},getLevel:function(a){return this.validLevel(a)?this["_"+a]:this._1},validLevel:function(a){return"undefined"!=typeof this[["_"+a]]?!0:!1},getHintPosition:function(a){var b=this.getLevel(LevelBuilder.currentLevel),c=new Point(99,99),d=2*(a-1);return"undefined"!=typeof b.hints[d]&&(c.x=b.hints[d],c.y=b.hints[d+1]),c}},LevelBuilder={editColour:Colours.darkGrey,currentLevel:1,build:function(a){for(var b=0;b<a.tiles.length;b+=2)this.setTile({x:a.tiles[b],y:a.tiles[b+1]},{col:a.colours[b],inv:a.colours[b+1]});for(var c=0;3>c;c++)Changers.availableChangers[c]=a.changers[c]},report:function(){var a=[],b=[];for(var c in GameMap.tiles)for(var d in GameMap.tiles[c])if(GameMap.tiles[c][d].visible&&GameMap.tiles[c][d].getFill()!==Colours.darkGrey){a[a.length]=parseInt(c),a[a.length]=parseInt(d);var e=this.getColourCode(GameMap.tiles[c][d].getFill());b[b.length]=e.col,b[b.length]=e.inv}},setTile:function(a,b){"undefined"==typeof GameMap.tiles[a.x]&&(GameMap.tiles[a.x]=[]);var c=Colours.red,d=!1;1===b.inv&&(d=!0),2===b.col?c=Colours.green:3===b.col&&(c=Colours.blue),0===b.inv?(GameMap.tiles[a.x][a.y].tileData.inverted=!1,GameMap.tiles[a.x][a.y].setFill(c),GameMap.tiles[a.x][a.y].setStroke(Colours.darken(c),GameMap.tiles[a.x][a.y].strokeWidth)):(GameMap.tiles[a.x][a.y].tileData.inverted=!0,GameMap.tiles[a.x][a.y].setFill(Colours.invertColour(c)),GameMap.tiles[a.x][a.y].setStroke(Colours.darken(Colours.invertColour(c)),GameMap.tiles[a.x][a.y].strokeWidth)),GameMap.tiles[a.x][a.y].tileData.primaryColour=c},getColourCode:function(a){var b={col:-1,inv:-1};switch(a){case Colours.red:b.col=1,b.inv=0;break;case Colours.green:b.col=2,b.inv=0;break;case Colours.blue:b.col=3,b.inv=0;break;case Colours.cyan:b.col=1,b.inv=1;break;case Colours.purple:b.col=2,b.inv=1;break;case Colours.yellow:b.col=3,b.inv=1}return b},nextLevel:function(){this.currentLevel++,"undefined"==typeof LevelData["_"+this.currentLevel]?MainGame.startState("mainMenu"):this.build(LevelData.getLevel(LevelBuilder.currentLevel))}},GameMap={tiles:[],hexRadius:45,boardSize:8,activeHex:null,gridCenter:null,fillColour:null,lineColour:null,backButtonColour:null,stratDragPoint:new Point(999,999),changeSelection:!1,mouseOverDragTimer:null,mouseOverAnimTimer:new Hexagon(0,0,0).invertAnimTime+20,loadingLevel:!1,clearingLevel:!0,fadeAlphaValue:0,fadeTime:300,showMenu:!1,hintHex:new Hexagon(0,0,0),hintsToShow:0,create:function(){this.gridCenter=new Point(MainGame.stageWidth/2,MainGame.stageHeight/2),this.hexRadius=45,this.createBoard(),Changers.removeAllChangers(),this.hintHex.setRadius(this.hexRadius),this.hintHex.setFill(Colours.none),this.hintHex.setStroke(Colours.white,3),LevelBuilder.currentLevel<=5&&Message.startMessage(),this.clearBoard(),LevelBuilder.build(LevelData.getLevel(LevelBuilder.currentLevel));for(var a in this.tiles)for(var b in this.tiles[a])this.tiles[a][b].getFill()!==Colours.darkGrey&&(this.tiles[a][b].visible=!0);this.createBackground()},createBackground:function(){MainGame.clearBackground();var a=document.getElementById("background").getContext("2d");a.fillStyle=Colours.black,a.fillRect(0,0,MainGame.stageWidth,MainGame.stageWidth);for(var b in this.tiles){var c=new Hexagon(40,0,0);for(var d in this.tiles[b])if(parseInt(b)>=-8&&parseInt(b)<=8){var e=HexagonalGridSystem.gridCoordToPixelCoord({x:parseInt(b),y:parseInt(d)},this.gridCenter,this.hexRadius);e.y>-this.hexRadius&&e.y<MainGame.stageHeight+this.hexRadius&&(c.center=e,c.radius=40,c.setFill(Colours.none),c.setStroke(Colours.setAlpha(Colours.darkGrey,.65),1),c.draw("background"))}}var f=LevelData.getLevel(LevelBuilder.currentLevel);1===f.colours[0]?this.backButtonColour=Colours.setAlpha(Colours.red,.75):2===f.colours[0]?this.backButtonColour=Colours.setAlpha(Colours.green,.75):3===f.colours[0]&&(this.backButtonColour=Colours.setAlpha(Colours.blue,.75))},createBoard:function(){this.fillColour=Colours.darkGrey,this.lineColour=Colours.darken(this.fillColour);for(var a=0,b=-this.boardSize;b<=this.boardSize;b++)for(var c=-this.boardSize;c<=this.boardSize;c++){var d=HexagonalGridSystem.gridCoordToPixelCoord(new Point(b,c),this.gridCenter,this.hexRadius);"undefined"==typeof this.tiles[b]&&(this.tiles[b]=[]),d.y>-this.hexRadius&&d.y<MainGame.stageHeight+this.hexRadius&&d.x>-this.hexRadius&&d.x<MainGame.stageWidth+this.hexRadius&&(this.tiles[b][c]=new Hexagon(this.hexRadius-Math.ceil(this.hexRadius/10),d.x,d.y),this.tiles[b][c].setFill(this.fillColour),this.tiles[b][c].setStroke(this.lineColour,Math.floor(this.hexRadius/10)),(d.y<this.hexRadius||d.y>MainGame.stageHeight-this.hexRadius||d.x<this.hexRadius||d.x>MainGame.stageWidth-this.hexRadius)&&(this.tiles[b][c].visible=!1),a++)}},clearBoard:function(){for(var a in this.tiles)for(var b in this.tiles[a])this.tiles[a][b].visible=!1,this.tiles[a][b].setFill(Colours.darkGrey),this.tiles[a][b].setStroke(Colours.darken(Colours.darkGrey),this.tiles[a][b].strokeWidth),this.tiles[a][b].tileData.inverted=!1},showBoard:function(){for(var a in this.tiles)for(var b in this.tiles[a])this.tiles[a][b].getFill()!==Colours.darkGrey&&(this.tiles[a][b].visible=!0)},fade:function(){if(this.loadingLevel){var a=document.getElementById(MainGame.currentState).getContext("2d");a.fillStyle=Colours.setAlpha(Colours.black,this.fadeAlphaValue),a.fillRect(0,0,MainGame.stageWidth,MainGame.stageHeight)}},fadeCalculations:function(){this.loadingLevel&&(Input.disableMouse(),this.clearingLevel?(this.fadeAlphaValue+=MainGame.lastFrameTime/this.fadeTime,this.fadeAlphaValue>=1&&(this.fadeAlphaValue=1,this.clearingLevel=!1,this.clearBoard(),Changers.removeAllChangers(),LevelBuilder.nextLevel(),this.createBackground(),Tutorial.resetMessage(),Message.startMessage(),this.showBoard(),this.hintsToShow=0)):(this.fadeAlphaValue-=MainGame.lastFrameTime/this.fadeTime,this.fadeAlphaValue<=.001&&(this.fadeAlphaValue=0,this.clearingLevel=!0,this.loadingLevel=!1,Input.enableMouse())))},checkPrimary:function(){var a=!0;for(var b in this.tiles)for(var c in this.tiles[b])this.tiles[b][c].visible&&this.tiles[b][c].tileData.inverted&&(a=!1);return a},update:function(){this.fadeCalculations(),"undefined"!=typeof this.tiles[Input.mouseHexaGridPos.x]&&"undefined"!=typeof this.tiles[Input.mouseHexaGridPos.x][Input.mouseHexaGridPos.y]&&this.onMouseOver(this.tiles[Input.mouseHexaGridPos.x][Input.mouseHexaGridPos.y]);for(var a in this.tiles)for(var b in this.tiles[a])parseInt(a)===Input.mouseHexaGridPos.x&&parseInt(b)===Input.mouseHexaGridPos.y||this.tiles[a][b].mouseOver!==!0||this.onMouseOut(this.tiles[a][b]);Colours.pulse(750),Changers.update()},render:function(a){this.drawHints();for(var b in this.tiles)for(var c in this.tiles[b])this.tiles[b][c].draw(MainGame.currentState);Changers.draw(),this.drawButtons(),Tutorial.draw(),Message.draw(),this.fade(),this.drawMenu()},drawButtons:function(){var a=document.getElementById(MainGame.currentState).getContext("2d");Input.mousePosition.x>0&&Input.mousePosition.x<50&&Input.mousePosition.y>0&&Input.mousePosition.y<50&&!this.changeSelection&&!Message.active?a.strokeStyle=Colours.lighten(this.backButtonColour):a.strokeStyle=this.backButtonColour,a.lineWidth=4,a.lineCap="round",a.beginPath(),a.moveTo(10,10),a.lineTo(40,10),a.stroke(),a.beginPath(),a.moveTo(10,20),a.lineTo(40,20),a.stroke(),a.beginPath(),a.moveTo(10,30),a.lineTo(40,30),a.stroke(),Input.mousePosition.x>=934&&Input.mousePosition.x<=1014&&Input.mousePosition.y>=10&&Input.mousePosition.y<=50&&!this.changeSelection&&!Message.active?a.fillStyle=Colours.lighten(Colours.setAlpha(this.backButtonColour,1)):a.fillStyle=Colours.setAlpha(this.backButtonColour,1),a.strokeStyle=Colours.darken(Colours.setAlpha(this.backButtonColour,1)),a.strokeRect(934,10,80,40),a.fillRect(934,10,80,40),a.font="bold 20px Arial",a.fillStyle=Colours.black,a.textAlign="center",a.textBaseline="middle",a.fillText("Hint ("+(LevelData.getLevel(LevelBuilder.currentLevel).hints.length/2-this.hintsToShow)+")",974,30)},drawMenu:function(){if(this.showMenu){var a=document.getElementById(MainGame.currentState).getContext("2d");a.fillStyle=Colours.setAlpha(Colours.black,.7),a.fillRect(0,0,MainGame.stageWidth,MainGame.stageWidth),a.strokeStyle=Colours.setAlpha(Colours.grey,.5),a.fillStyle=Colours.setAlpha(Colours.darkGrey,.8),a.lineWidth=3,a.fillRect(306,75,412,375),a.strokeRect(306,75,412,375),a.fillStyle=Colours.setAlpha(Colours.blue,.5),Input.mousePosition.x>=310&&Input.mousePosition.x<=714&&(Input.mousePosition.y>=195&&Input.mousePosition.y<=255?a.fillRect(310,195,404,60):Input.mousePosition.y>=270&&Input.mousePosition.y<=330?a.fillRect(310,270,404,60):Input.mousePosition.y>=345&&Input.mousePosition.y<=405&&a.fillRect(310,345,404,60)),a.font="50px Arial",a.fillStyle=Colours.white,a.textAlign="center",a.textBaseline="top",a.fillText("level "+LevelBuilder.currentLevel+" of 15",MainGame.stageWidth/2,100),a.font="40px Arial",a.fillText("main menu",MainGame.stageWidth/2,200),a.fillText("restart level",MainGame.stageWidth/2,275),a.fillText("resume game",MainGame.stageWidth/2,350)}},drawHints:function(){if(this.hintsToShow>0)for(var a=1;a<=this.hintsToShow;a++)this.hintHex.center=HexagonalGridSystem.externalGridCoordToPixelCoord(LevelData.getHintPosition(a),this.gridCenter,this.hexRadius),this.hintHex.draw(MainGame.currentState)},onMouseOver:function(a){a.mouseOver||a.animating||(a.mouseOver=!0,Changers.active||this.changeSelection||Message.active||this.showMenu||Motion.strokeFade(a,Colours.white,a.animationTime/2))},onMouseOut:function(a){a.mouseOver&&!a.animating&&(a.mouseOver=!1,Changers.active||Motion.strokeFade(a,Colours.darken(a.getFill()),a.animationTime))},onClick:function(a){Message.active||this.showMenu?this.showMenu?Input.mousePosition.x>=310&&Input.mousePosition.x<=714&&(Input.mousePosition.y>=195&&Input.mousePosition.y<=255?MainGame.startState("mainMenu"):Input.mousePosition.y>=270&&Input.mousePosition.y<=330?(LevelBuilder.currentLevel--,this.showMenu=!1,this.loadNextLevel()):Input.mousePosition.y>=345&&Input.mousePosition.y<=405&&(this.showMenu=!1)):Message.destroyMessage():(Input.mousePosition.x>0&&Input.mousePosition.x<50&&Input.mousePosition.y>0&&Input.mousePosition.y<50&&!this.showMenu?(Changers.active=!1,this.showMenu=!0):Input.mousePosition.x>=934&&Input.mousePosition.x<=1014&&Input.mousePosition.y>=10&&Input.mousePosition.y<=50&&(this.hintsToShow++,99===LevelData.getHintPosition(this.hintsToShow).x&&this.hintsToShow--,this.showMenu=!1),Changers.onClick()),Tutorial.nextMessage()},onMouseDragStart:function(){this.mouseOverDragTimer=MainGame.timeNow(),this.stratDragPoint.equals(Input.mouseHexaGridPos),Changers.isChangerAt(this.stratDragPoint)&&!Changers.active&&(this.changeSelection=!0)},onMouseDrag:function(a){this.changeSelection&&Changers.updateSelection(this.stratDragPoint)},onMouseDragStop:function(){this.changeSelection&&(this.mouseOverDragTimer=MainGame.timeNow(),Changers.commitSelection(),this.changeSelection=!1),this.stratDragPoint=new Point(999,999),this.checkVictoryConditions(),Tutorial.nextMessage()},tileAtPoint:function(a){var b=HexagonalGridSystem.pixelCoordToGridCoord(a,this.gridCenter,this.hexRadius);return this.validTile(b)?this.tiles[b.x][b.y]:null},setActiveHexagon:function(a){this.validTile(a)&&(this.activeHex=this.tiles[a.x][a.y])},getActiveHexagonGridPoint:function(){return null!==this.activeHex?this.pixelCoordToGridCoord(this.activeHex.center):void 0},clearActiveHexagon:function(){this.activeHex=null},validTile:function(a){return"undefined"!=typeof this.tiles[a.x]&&"undefined"!=typeof this.tiles[a.x][a.y]?!0:!1},pixelCoordToGridCoord:function(a){return HexagonalGridSystem.pixelCoordToGridCoord(a,this.gridCenter,this.hexRadius)},loadNextLevel:function(){LevelData.validLevel(LevelBuilder.currentLevel+1)?this.loadingLevel=!0:(LevelBuilder.currentLevel=1,Tutorial.completed=!1,MainGame.startState("mainMenu"))},checkVictoryConditions:function(){this.checkPrimary()&&Message.completeMessage()},deleteState:function(){this.tiles=[],this.hexRadius=45,this.boardSize=8,this.activeHex=null,this.gridCenter=null,this.fillColour=null,this.lineColour=null,this.stratDragPoint=new Point(999,999),this.changeSelection=!1,this.mouseOverDragTimer=null,this.mouseOverAnimTimer=new Hexagon(0,0,0).invertAnimTime+20,this.loadingLevel=!1,this.clearingLevel=!0,this.frameDelayCount=0,this.animClearRow=-7,this.animClearCol=7,this.showMenu=!1,this.hintsToShow=0}},Selection={tiles:[],maxCircleSize:2,lastValidLineType:["moveUp","up"],black:function(){for(var a in this.tiles)this.tiles[a].setFill("rgba(0,0,0,1)")},selectByType:function(a,b,c){1===c?this.selectLine(a,b):2===c?this.selectCircle(a,b):3===c&&this.selectRing(a,b)},selectLine:function(a,b){this.tiles[this.tiles.length]=GameMap.tiles[a.x][a.y];var c=GameMap.pixelCoordToGridCoord(this.tiles[0].center),d=new Point(c.x,c.y),e="moveUp",f="up";c.x===b.x?c.y>b.y?(e="moveUp",f="up",this.lastValidLineType=[e,f]):c.y<b.y&&(e="moveDown",f="up",this.lastValidLineType=[e,f]):c.y===b.y?c.x>b.x?(e="moveLeft",f="up",this.lastValidLineType=[e,f]):c.x<b.x&&(e="moveRight",f="down",this.lastValidLineType=[e,f]):b.x-c.x===c.y-b.y?c.x<b.x?(e="moveRight",f="up",this.lastValidLineType=[e,f]):c.x>b.x&&(e="moveLeft",f="down",this.lastValidLineType=[e,f]):GameMap.changeSelection&&Input.dragging&&(e=this.lastValidLineType[0],f=this.lastValidLineType[1]);do d=Navigation[e](d,f),GameMap.validTile(d)&&(this.tiles[this.tiles.length]=GameMap.tiles[d.x][d.y]);while(GameMap.validTile(d))},selectCircle:function(a,b){this.tiles[this.tiles.length]=GameMap.tiles[a.x][a.y];var c=GameMap.pixelCoordToGridCoord(this.tiles[0].center),d=HexagonalGridSystem.distance(c,b);d>this.maxCircleSize?d=this.maxCircleSize:0===d&&(d=1);for(var e=d,f=0;e>f;f++)this.addRingToSelection(c,d),d--},selectRing:function(a,b){this.tiles[this.tiles.length]=GameMap.tiles[a.x][a.y];var c=GameMap.pixelCoordToGridCoord(this.tiles[0].center),d=HexagonalGridSystem.distance(c,b);2>d&&(d=2),this.addRingToSelection(c,d)},addRingToSelection:function(a,b){var c=new Point(a.x,a.y-b),d=new Point(c.x,c.y);GameMap.validTile(d)&&(this.tiles[this.tiles.length]=GameMap.tiles[d.x][d.y]);var e=b;for(e=b;e>0;e--)d=Navigation.moveLeft(d,"down"),GameMap.validTile(d)&&(this.tiles[this.tiles.length]=GameMap.tiles[d.x][d.y]);for(e=b;e>0;e--)d=Navigation.moveDown(d),GameMap.validTile(d)&&(this.tiles[this.tiles.length]=GameMap.tiles[d.x][d.y]);for(e=b;e>0;e--)d=Navigation.moveRight(d,"down"),GameMap.validTile(d)&&(this.tiles[this.tiles.length]=GameMap.tiles[d.x][d.y]);for(e=b;e>0;e--)d=Navigation.moveRight(d,"up"),GameMap.validTile(d)&&(this.tiles[this.tiles.length]=GameMap.tiles[d.x][d.y]);for(e=b;e>0;e--)d=Navigation.moveUp(d),GameMap.validTile(d)&&(this.tiles[this.tiles.length]=GameMap.tiles[d.x][d.y]);for(e=b;e>0;e--)d=Navigation.moveLeft(d,"up"),GameMap.validTile(d)&&d.x!==c.x&&(this.tiles[this.tiles.length]=GameMap.tiles[d.x][d.y])},clearSelection:function(){this.tiles=[]}},Changers={active:!1,visualHex:null,blockPosition:null,activeHexIndexs:null,menuWidth:280,menuHeight:100,buttonOffset:10,buttonWidth:0,buttonHeight:0,mouseOverButton:0,mouseOverSelectionPulse:0,placedChangers:[],maxCircleSize:2,availableChangers:[0,0,0],menuColours:{blockFill:Colours.grey,blockStroke:Colours.white,buttonFill:Colours.darken(Colours.grey),buttonStroke:Colours.black},changerData:{colour:["rgba(255,0,0,1)","rgba(0,255,0,1)","rgba(0,0,255,1)"],mainColour:"",secondaryColour:"",radius:Math.round(GameMap.hexRadius/2.5),selectionIndex:-1,currentChangerType:0,activeHexChangerIndex:-1},init:function(){this.buttonWidth=(this.menuWidth-4*this.buttonOffset)/3,this.buttonHeight=this.menuHeight-2*this.buttonOffset},createMenu:function(){if(!this.active){this.active=!0,GameMap.setActiveHexagon(Input.mouseHexaGridPos);for(var a in this.placedChangers){var b=GameMap.pixelCoordToGridCoord(this.placedChangers[a].center),c=GameMap.getActiveHexagonGridPoint();b.x===c.x&&b.y===c.y&&(this.changerData.activeHexChangerIndex=parseInt(a))}this.setPosition()}},update:function(){this.mouseOverButton=0;for(var a=1;3>=a;a++)this.pointOverButton(Input.mousePosition,a)&&(this.mouseOverButton=a);this.pulseSelectedTiles()},draw:function(){this.drawChangers(MainGame.currentState),this.drawInvertorInfo(MainGame.currentState),this.active&&(this.drawBlock(MainGame.currentState),this.drawButtons(MainGame.currentState))},drawInvertorInfo:function(a){for(var b=1;3>=b;b++){var c=MainGame.stageHeight/2+75*(b-2);this.drawIconType(b,{x:985,y:c},a,Colours.grey,Colours.darkGrey),this.drawButtonText(b,{x:950,y:c+11},a)}},drawBlock:function(a){var b=document.getElementById(a).getContext("2d");b.strokeStyle=this.menuColours.blockStroke,b.fillStyle=this.menuColours.blockFill,b.lineWidth=4,b.fillRect(this.blockPosition.x,this.blockPosition.y,this.menuWidth,this.menuHeight),b.strokeRect(this.blockPosition.x,this.blockPosition.y,this.menuWidth,this.menuHeight)},drawButtons:function(a){for(var b=1;3>=b;b++)this.mouseOverButton===b&&this.availableChangers[b-1]>0?this.drawButton(a,this.menuColours.buttonStroke,Colours.lightBurntGreen,b):0===this.availableChangers[b-1]&&this.changerData.activeHexChangerIndex>=0?this.placedChangers[this.changerData.activeHexChangerIndex].tileData.changerType===b&&this.mouseOverButton===b?this.drawButton(a,this.menuColours.buttonStroke,Colours.burntCyan,b):this.placedChangers[this.changerData.activeHexChangerIndex].tileData.changerType===b?this.drawButton(a,this.menuColours.buttonStroke,Colours.burntBlue,b):this.drawButton(a,this.menuColours.buttonStroke,Colours.burntRed,b):0===this.availableChangers[b-1]?this.drawButton(a,this.menuColours.buttonStroke,Colours.burntRed,b):this.drawButton(a,this.menuColours.buttonStroke,Colours.burntGreen,b)},drawButton:function(a,b,c,d){var e=document.getElementById(a).getContext("2d");e.strokeStyle=b,e.fillStyle=c,e.lineWidth=2,e.fillRect(this.blockPosition.x+this.buttonOffset+(this.buttonOffset+this.buttonWidth)*(d-1),this.blockPosition.y+this.buttonOffset,this.buttonWidth,this.buttonHeight),e.strokeRect(this.blockPosition.x+this.buttonOffset+(this.buttonOffset+this.buttonWidth)*(d-1),this.blockPosition.y+this.buttonOffset,this.buttonWidth,this.buttonHeight);var f={x:this.blockPosition.x+this.buttonOffset+(this.buttonOffset+this.buttonWidth)*(d-1)+this.buttonWidth/2,y:this.blockPosition.y+this.buttonOffset+this.buttonHeight/2};this.drawIconType(d,f,a,Colours.white,Colours.grey),this.drawButtonText(d,{x:f.x+this.buttonWidth/2.15,y:f.y+this.buttonHeight/2.15},a)},drawButtonText:function(a,b,c){var d=document.getElementById(c).getContext("2d");d.font="20px Arial",d.fillStyle=Colours.white,d.textAlign="right",d.textBaseline="bottom";for(var e=1;3>=e;e++)d.fillText(this.availableChangers[a-1],b.x,b.y)},drawChangers:function(a){if(this.placedChangers.length>0)for(var b in this.placedChangers)this.drawIcon(this.placedChangers[b],a)},drawIcon:function(a,b){var c=(document.getElementById(b).getContext("2d"),"rgba(255,255,255,1)"),d=Colours.grey;a.tileData.changerActive||(c=Colours.black,d=Colours.darkGrey),1===a.tileData.changerType?this.drawLineIcon(a.center,b,c,d):2===a.tileData.changerType?this.drawCircleIcon(a.center,b,c,d):3===a.tileData.changerType&&this.drawRingIcon(a.center,b,c,d)},drawIconType:function(a,b,c,d,e){1===a?this.drawLineIcon(b,c,d,e):2===a?this.drawCircleIcon(b,c,d,e):3===a&&this.drawRingIcon(b,c,d,e)},drawLineIcon:function(a,b,c,d){var e=document.getElementById(b).getContext("2d"),f=new Hexagon(this.changerData.radius,a.x,a.y);f.setFill(c),f.setStroke(Colours.none),f.draw(b),e.fillStyle=d,e.fillRect(f.center.x-this.changerData.radius/2,f.center.y-1.65*this.changerData.radius,f.radius,.6*f.radius)},drawCircleIcon:function(a,b,c,d){var e=new Hexagon(Math.round(this.changerData.radius*(2/3)),a.x,a.y),f=new Hexagon(2.5*Math.round(this.changerData.radius*(2/3)),a.x,a.y);f.setFill(d),f.setStroke(Colours.none),f.draw(b),e.setFill(c),e.setStroke(Colours.none),e.draw(b)},drawRingIcon:function(a,b,c,d){var e=new Hexagon(Math.round(this.changerData.radius*(2/3)),a.x,a.y),f=new Hexagon(2*Math.round(this.changerData.radius*(2/3)),a.x,a.y);f.setFill(Colours.none),f.setStroke(d,6),f.draw(b),e.setFill(c),e.setStroke(Colours.none),e.draw(b)},onClick:function(){this.active?this.pointOverMenu(Input.mousePosition)||this.destroyMenu():GameMap.validTile(Input.mouseHexaGridPos)&&GameMap.tiles[Input.mouseHexaGridPos.x][Input.mouseHexaGridPos.y].visible&&this.createMenu(),this.menuButtonClick()},menuButtonClick:function(){if(0!==this.mouseOverButton){this["button"+this.mouseOverButton](),this.clearPulsingTiles();this.availableChangers[this.mouseOverButton-1]>0&&this.destroyMenu()}},button1:function(){this.tryToPlace(1)},button2:function(){this.tryToPlace(2)},button3:function(){this.tryToPlace(3)},setChangerData:function(a,b,c){"undefined"==typeof c&&(c=GameMap.getActiveHexagonGridPoint()),this.placedChangers[a].tileData.changerType=b,this.placedChangers[a].tileData.changerPoint=c},tryToPlace:function(a){var b=GameMap.getActiveHexagonGridPoint(),c=-1,d=!0,e=!1;if(this.placedChangers.length>0)for(var f in this.placedChangers){var g=GameMap.pixelCoordToGridCoord(this.placedChangers[f].center);if(b.x===g.x&&b.y===g.y){if(c=parseInt(f),this.placedChangers[c].tileData.changerType===a){d=!1,this.remove(c);break}this.availableChangers[a-1]>0?(this.remove(c),e=!0):(this.destroyMenu(),d=!1);break}}d&&(this.availableChangers[a-1]>0&&(e=!0),this.place(a),e&&this.destroyMenu())},place:function(a){this.availableChangers[a-1]>0&&(this.availableChangers[a-1]--,this.placedChangers[this.placedChangers.length]=new Hexagon(this.changerData.radius,GameMap.activeHex.center.x,GameMap.activeHex.center.y),this.placedChangers[this.placedChangers.length-1].setFill(this.changerData.colour[a-1]),this.placedChangers[this.placedChangers.length-1].setStroke(Colours.darken(this.placedChangers[this.placedChangers.length-1].getFill()),Math.floor(GameMap.hexRadius/5)),this.setChangerData(this.placedChangers.length-1,a),this.placedChangers[this.placedChangers.length-1].tileData.changerActive=!1)},remove:function(a){if(!(0>a||a>this.placedChangers.length)){var b=[];if(this.placedChangers[a].tileData.changerActive)switch(this.placedChangers[a].tileData.changerType){case 1:this.invertLine(this.placedChangers[a].tileData.changerPoint);break;case 2:this.invertCircle(this.placedChangers[a].tileData.changerPoint);break;case 3:this.invertRing(this.placedChangers[a].tileData.changerPoint)}if(this.placedChangers.length>0)for(var c=0,d=0;d<this.placedChangers.length;d++)d!==a&&(b[c]=this.placedChangers[d],c++);this.availableChangers[this.placedChangers[a].tileData.changerType-1]++,this.placedChangers=b}},isChangerAt:function(a){var b=!1;for(var c in this.placedChangers){var d=HexagonalGridSystem.pixelCoordToGridCoord(this.placedChangers[c].center,GameMap.gridCenter,GameMap.hexRadius);a.x===d.x&&a.y===d.y&&(b=!0)}return b},invertLine:function(a){Selection.selectLine(GameMap.getActiveHexagonGridPoint(),a),this.invertSelected(),this.clearPulsingTiles()},invertCircle:function(a){Selection.selectCircle(GameMap.getActiveHexagonGridPoint(),a),this.invertSelected(),this.clearPulsingTiles()},invertRing:function(a){Selection.selectRing(GameMap.getActiveHexagonGridPoint(),a),this.invertSelected(),this.clearPulsingTiles()},updateSelection:function(a){var b="",c="";if(1===this.changerData.currentChangerType?b="Line":2===this.changerData.currentChangerType?b="Circle":3===this.changerData.currentChangerType&&(b="Ring"),this.changerData.selectionIndex<0){for(var d in this.placedChangers){var e=GameMap.pixelCoordToGridCoord(this.placedChangers[d].center);a.x===e.x&&a.y===e.y&&(this.changerData.selectionIndex=parseInt(d),GameMap.setActiveHexagon(GameMap.pixelCoordToGridCoord(this.placedChangers[this.changerData.selectionIndex].center)))}this.changerData.currentChangerType=this.placedChangers[this.changerData.selectionIndex].tileData.changerType,1===this.changerData.currentChangerType?b="Line":2===this.changerData.currentChangerType?b="Circle":3===this.changerData.currentChangerType&&(b="Ring"),c="invert"+b,this.placedChangers[this.changerData.selectionIndex].tileData.changerActive&&this[c](this.placedChangers[this.changerData.selectionIndex].tileData.changerPoint),Colours.startPulse()}c="select"+b,this.clearPulsingTiles(),Selection[c](GameMap.getActiveHexagonGridPoint(),Input.mouseHexaGridPos)},commitSelection:function(){if(1===this.changerData.currentChangerType){if("undefined"!=typeof Selection.tiles[1]){var a=GameMap.pixelCoordToGridCoord(Selection.tiles[0].center),b=GameMap.pixelCoordToGridCoord(Selection.tiles[1].center);a.x===b.x?a.y>b.y?this.placedChangers[this.changerData.selectionIndex].tileData.changerPoint=Navigation.moveUp(a):a.y<b.y&&(this.placedChangers[this.changerData.selectionIndex].tileData.changerPoint=Navigation.moveDown(a)):a.y===b.y?a.x>b.x?this.placedChangers[this.changerData.selectionIndex].tileData.changerPoint=Navigation.moveLeft(a,"up"):a.x<b.x&&(this.placedChangers[this.changerData.selectionIndex].tileData.changerPoint=Navigation.moveRight(a,"down")):b.x-a.x===a.y-b.y&&(a.x<b.x?this.placedChangers[this.changerData.selectionIndex].tileData.changerPoint=Navigation.moveRight(a,"up"):a.x>b.x&&(this.placedChangers[this.changerData.selectionIndex].tileData.changerPoint=Navigation.moveLeft(a,"down")))}}else this.setChangerData(this.changerData.selectionIndex,this.changerData.currentChangerType,Input.mouseHexaGridPos);this.invertSelected(),Colours.stopPulse(),this.clearPulsingTiles(),this.placedChangers[this.changerData.selectionIndex].tileData.changerActive=!0,this.changerData.selectionIndex=-1,this.changerData.currentChangerType=0,GameMap.clearActiveHexagon()},invertSelected:function(){if(Selection.tiles.length>0)for(var a in Selection.tiles)Selection.tiles[a].invertColour()},pulseSelectedTiles:function(){if(Selection.tiles.length>0)for(var a in Selection.tiles)"0"==a?Selection.tiles[a].tileData.pulseType="white":Selection.tiles[a].tileData.pulseType="grey",Selection.tiles[a].pulsing=!0},clearPulsingTiles:function(){if(Selection.tiles.length>0){for(var a in Selection.tiles)Selection.tiles[a].pulsing=!1;Selection.clearSelection()}},pointOverMenu:function(a){return this.active&&a.x>=this.blockPosition.x&&a.x<=this.blockPosition.x+this.menuWidth&&a.y>=this.blockPosition.y&&a.y<=this.blockPosition.y+this.menuHeight?!0:!1},pointOverButton:function(a,b){if(this.active){var c=this.blockPosition.x+this.buttonOffset+(this.buttonOffset+this.buttonWidth)*(b-1),d=this.blockPosition.y+this.buttonOffset;if(a.x>=c&&a.x<=c+this.buttonWidth&&a.y>=d&&a.y<=d+this.buttonHeight)return!0}return!1},setPosition:function(){this.activeHexIndexs={row:Input.mouseHexaGridPos.x,col:Input.mouseHexaGridPos.y},this.blockPosition=HexagonalGridSystem.externalGridCoordToPixelCoord(Input.mouseHexaGridPos,GameMap.gridCenter,GameMap.hexRadius),this.blockPosition.x<this.menuWidth/2?this.blockPosition.x-=.25*this.menuWidth:this.blockPosition.x>MainGame.stageWidth-this.menuWidth/2?this.blockPosition.x-=.75*this.menuWidth:this.blockPosition.x-=this.menuWidth/2,this.blockPosition.y>4*GameMap.hexRadius?this.blockPosition.y-=this.menuHeight+GameMap.hexRadius:this.blockPosition.y+=GameMap.hexRadius},removeAllChangers:function(){this.placedChangers=[];for(var a=LevelData.getLevel(LevelBuilder.currentLevel),b=0;3>b;b++)this.availableChangers[b]=a.changers[b]},destroyMenu:function(){this.active&&(this.active=!1,this.blockPosition=null,this.visualHex=null,GameMap.clearActiveHexagon(),this.changerData.activeHexChangerIndex=-1,this.updateMouseOverStates())},updateMouseOverStates:function(){var a=-1;if(this.placedChangers.length>0)for(var b in this.placedChangers){var c=GameMap.pixelCoordToGridCoord(this.placedChangers[b].center);this.activeHexIndexs.row===c.x&&this.activeHexIndexs.col===c.y&&(a=parseInt(b))}GameMap.tiles[this.activeHexIndexs.row][this.activeHexIndexs.col].animating||(GameMap.tiles[this.activeHexIndexs.row][this.activeHexIndexs.col].mouseOver=!0),GameMap.onMouseOut(GameMap.tiles[this.activeHexIndexs.row][this.activeHexIndexs.col]),this.activeHexIndexs=null;for(var d in GameMap.tiles)for(var e in GameMap.tiles[d])GameMap.tiles[d][e].mouseOver!==!0||GameMap.tiles[d][e].animating||(GameMap.tiles[d][e].mouseOver=!1,GameMap.onMouseOver(GameMap.tiles[d][e]))}},Navigation={moveUp:function(a,b){var c=new Point(0,0);return c.x=a.x,c.y=a.y-1,c},moveDown:function(a,b){var c=new Point(0,0);return c.x=a.x,c.y=a.y+1,c},moveLeft:function(a,b){var c=new Point(0,0);return"undefined"==typeof b&&(b="up"),0===b.indexOf("u")?(c.x=a.x-1,c.y=a.y):(c.x=a.x-1,c.y=a.y+1),c},moveRight:function(a,b){var c=new Point(0,0);return"undefined"==typeof b&&(b="up"),0===b.indexOf("u")?(c.x=a.x+1,c.y=a.y-1):(c.x=a.x+1,c.y=a.y),c},jumpLeft:function(a){var b=this.moveLeft(a,"up");return this.moveLeft(b,"down")},jumpRight:function(a){var b=this.moveRight(a,"up");return this.moveRight(b,"down")}},Game=function(a){this.stageWidth=1024,this.stageHeight=576,this.elementID=a,this.currentState=null,this.stateToStart=null,this.states=[],this.lastUpdate=(new Date).getTime(),this.lastFrameTime=1e3/60,this.secondTimer=null,this.frameCounter=1,this.gameStarted=!1,this.gameOver=!1,this.fading=!0,this.fadingToBlack=!1,this.fadeAlpha=1,this.fadeTime=300,this.onGameCreationRun()};Game.prototype={onGameCreationRun:function(){document.getElementById("Hex").style.width=this.stageWidth.toString()+"px",document.getElementById("Hex").style.height=this.stageHeight.toString()+"px",Colours.init(),Changers.init()},create:function(){this.gameOver=!1,null===document.getElementById("mainBackground")&&createCanvas(this.stageWidth,this.stageHeight,"mainBackground",this.elementID),null===document.getElementById("background")&&createCanvas(this.stageWidth,this.stageHeight,"background",this.elementID),createCanvas(this.stageWidth,this.stageHeight,this.currentState,this.elementID),this.states[this.currentState].create(),this.gameStarted||(GameLoop(),this.gameStarted=!0)},input:function(){"function"==typeof this.states[this.currentState].input&&this.states[this.currentState].input()},update:function(){this.calculateLastFrameTime(),"function"==typeof this.states[this.currentState].update&&this.states[this.currentState].update()},render:function(){document.getElementById(this.currentState).width=this.stageWidth,"function"==typeof this.states[this.currentState].render&&this.states[this.currentState].render(),this.fade()},fade:function(){if(this.fading){this.fadingToBlack?(this.fadeAlpha+=this.lastFrameTime/this.fadeTime,this.fadeAlpha>=1&&(this.fadeAlpha=1,this.fadingToBlack=!1,Input.removeMouseListeners(this.currentState),this.deleteState(),this.currentState=this.stateToStart,this.create(),Input.addMouseListeners(this.currentState),Input.enableMouse())):(this.fadeAlpha-=this.lastFrameTime/this.fadeTime,this.fadeAlpha<=.001&&(this.fadeAlpha=0,this.fadingToBlack=!0,this.fading=!1));var a=document.getElementById(this.currentState).getContext("2d");a.fillStyle=Colours.setAlpha(Colours.black,this.fadeAlpha),a.fillRect(0,0,this.stageWidth,this.stageHeight)}},deleteState:function(){deleteCanvas(this.currentState),deleteCanvas("background"),deleteCanvas("mainBackground"),"undefined"!=typeof this.states[this.currentState]&&"function"==typeof this.states[this.currentState].deleteState&&this.states[this.currentState].deleteState()},addState:function(a,b){for(var c in this.states)if(c===a)return;this.states[a]=b},startState:function(a){for(var b in this.states)if(b===a)return void(this.gameStarted?(this.stateToStart=a,this.fading=!0,this.fadeToBlack=!0):(Input.removeMouseListeners(this.currentState),this.deleteState(),this.currentState=a,this.create(),Input.addMouseListeners(this.currentState),Input.enableMouse()))},clearBackground:function(){document.getElementById("background").width=this.stageWidth},calculateLastFrameTime:function(){var a=(new Date).getTime();this.lastFrameTime=a-this.lastUpdate,
this.lastFrameTime>1e3&&(this.lastFrameTime=60),this.lastUpdate=a},timeNow:function(){return this.lastUpdate},fpsLogger:function(){(null===this.secondTimer||this.timeNow()-this.secondTimer>1e3)&&(this.secondTimer=this.timeNow(),this.frameCounter=0),this.frameCounter++}}; var MainGame = new Game("Hex");MainGame.addState("mainMenu", MainMenu);MainGame.addState("gameBoard", GameMap);MainGame.startState("mainMenu");</script></body></html>